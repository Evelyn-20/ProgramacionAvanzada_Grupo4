@using Pasteleria.Abstracciones.ModeloUI
@using X.PagedList
@using X.PagedList.Mvc.Core
@model IPagedList<Cliente>

@{
    ViewBag.Title = "Listado de Clientes";
}

<!-- Banner Hero -->
<section class="hero" style="padding: 3rem 0;">
    <div class="hero-content">
        <h1 class="hero-title">Listado de Clientes</h1>
        <p class="hero-subtitle">Administra y visualiza toda la información de tus clientes</p>
    </div>
</section>

<div class="container" style="padding: 3rem 20px; max-width: 1400px;">
    <!-- Barra de búsqueda y botón agregar -->
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;gap:1rem;flex-wrap:wrap;">
        <form method="get" asp-action="ListadoClientes" style="display:flex;gap:1rem;flex:1;">
            <input type="text" name="Buscar" placeholder="Buscar por nombre, cédula, correo o teléfono..."
                   value="@(Context.Request.Query["Buscar"])"
                   style="flex:1; padding:1rem; border:2px solid var(--secondary-color); border-radius:50px;" />
            <button class="btn btn-outline-secondary" type="submit">Buscar</button>
            @if (!string.IsNullOrEmpty(Context.Request.Query["Buscar"]))
            {
                <a asp-action="ListadoClientes" class="btn btn-secondary">Limpiar</a>
            }
        </form>

        <a asp-action="CrearCliente" class="btn btn-primary" style="white-space:nowrap;">+ Agregar Cliente</a>
    </div>

    <!-- Mensajes de éxito o error -->
    @if (TempData["ok"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert" style="margin-bottom:2rem; border-radius:10px;">
            <i class="fas fa-check-circle"></i> @TempData["ok"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert" style="margin-bottom:2rem; border-radius:10px;">
            <i class="fas fa-exclamation-triangle"></i> @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Tabla con estilo mejorado -->
    <div style="background:var(--white); border-radius:15px; box-shadow:var(--shadow); overflow:hidden;">
        <div class="table-responsive">
            <table style="margin-bottom:0; width:100%; border-collapse:collapse;">
                <thead style="background:linear-gradient(135deg, var(--secondary-color) 0%, #e8d4bc 100%);">
                    <tr>
                        <th style="padding:1.2rem;">#</th>
                        <th style="padding:1.2rem;">Cédula</th>
                        <th style="padding:1.2rem;">Nombre</th>
                        <th style="padding:1.2rem;">Correo</th>
                        <th style="padding:1.2rem;">Teléfono</th>
                        <th style="padding:1.2rem;">Dirección</th>
                        <th style="padding:1.2rem;">Estado</th>
                        <th style="padding:1.2rem; width:200px;">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        foreach (var c in Model)
                        {
                            <tr style="border-bottom:1px solid var(--secondary-color); transition:background 0.3s;"
                                onmouseover="this.style.background='var(--light-color)'"
                                onmouseout="this.style.background='transparent'">
                                <td style="padding:1.2rem; color:var(--text-color);">@c.IdCliente</td>
                                <td style="padding:1.2rem; color:var(--text-color);">@c.Cedula</td>
                                <td style="padding:1.2rem; color:var(--dark-color); font-weight:500;">@c.NombreCliente</td>
                                <td style="padding:1.2rem; color:var(--text-color);">@c.Correo</td>
                                <td style="padding:1.2rem; color:var(--text-color);">@c.Telefono</td>
                                <td style="padding:1.2rem; color:var(--text-color); max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">@c.Direccion</td>
                                <td style="padding:1.2rem;">
                                    @if (c.Estado)
                                    {
                                        <span style="background:#27ae60; color:var(--white); padding:0.4rem 1rem; border-radius:20px; font-size:0.85rem; font-weight:600;">Activo</span>
                                    }
                                    else
                                    {
                                        <span style="background:#e74c3c; color:var(--white); padding:0.4rem 1rem; border-radius:20px; font-size:0.85rem; font-weight:600;">Inactivo</span>
                                    }
                                </td>
                                <td style="padding:1.2rem;">
                                    <div class="btn-group" role="group">
                                        <a asp-action="EditarCliente" asp-route-id="@c.IdCliente" class="btn btn-sm btn-primary">Editar</a>
                                        <form asp-action="EliminarCliente" method="post" style="display:inline;"
                                              onsubmit="return confirm('¿Eliminar cliente @c.NombreCliente?');">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="IdCliente" value="@c.IdCliente" />
                                            <button class="btn btn-sm btn-danger">Eliminar</button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="8" style="padding:3rem; text-align:center; color:var(--text-color);">
                                <i class="fas fa-users" style="font-size:3rem; color:var(--secondary-color); margin-bottom:1rem; display:block;"></i>
                                <p style="font-size:1.2rem; margin:0;">
                                    @if (!string.IsNullOrEmpty(Context.Request.Query["Buscar"]))
                                    {
                                        <text>No se encontraron clientes con el término: <strong>@Context.Request.Query["Buscar"]</strong></text>
                                    }
                                    else
                                    {
                                        <text>No hay clientes registrados. ¡Agrega el primero!</text>
                                    }
                                </p>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Footer de paginación SIMPLIFICADO -->
        @if (Model != null && Model.Count > 0)
        {
            <div style="padding:1.5rem; background:var(--light-color); display:flex; justify-content:space-between; align-items:center; border-top:1px solid var(--secondary-color); flex-wrap:wrap; gap:1rem;">
                <div style="color:var(--text-color); font-size:0.95rem;">
                    Mostrando <strong>@Model.FirstItemOnPage - @Model.LastItemOnPage</strong> de <strong>@Model.TotalItemCount</strong> clientes
                </div>
                <div>
                    @Html.PagedListPager(Model, page => Url.Action("ListadoClientes", new { Buscar = Context.Request.Query["Buscar"], Pagina = page }))
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        // Auto-ocultar alertas después de 5 segundos
        setTimeout(function () {
            var alerts = document.querySelectorAll('.alert');
            alerts.forEach(function (alert) {
                var bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);
    </script>
}