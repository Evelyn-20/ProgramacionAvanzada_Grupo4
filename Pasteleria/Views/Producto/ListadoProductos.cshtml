@using Pasteleria.Abstracciones.ModeloUI
@model IEnumerable<Producto>

@{
    ViewBag.Title = "Inventario";
}

<section class="hero" style="padding: 3rem 0;">
    <div class="hero-content">
        <h1 class="hero-title">Inventario</h1>
        <p class="hero-subtitle">Administra y visualiza todo el inventario de productos</p>
    </div>
</section>

<div class="container" style="padding: 3rem 20px; max-width: 1400px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;gap:1rem;flex-wrap:wrap;">
        <form method="get" asp-action="ListadoProductos" style="display:flex;gap:1rem;flex:1;">
            <input type="text" name="Nombre" placeholder="Buscar por nombre..."
                   value="@(Context.Request.Query["Nombre"])"
                   style="flex:1; padding:1rem; border:2px solid var(--secondary-color); border-radius:50px;" />
            <input type="number" name="IdCategoria" placeholder="Categoría (Id)"
                   value="@(Context.Request.Query["IdCategoria"])"
                   style="width:220px; padding:1rem; border:2px solid var(--secondary-color); border-radius:10px;" />
            <button class="btn btn-outline-secondary" type="submit">Filtrar</button>
        </form>

        <a asp-action="CrearProducto" class="btn btn-primary" style="white-space:nowrap;">+ Agregar Producto</a>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    <div style="background:var(--white); border-radius:15px; box-shadow:var(--shadow); overflow:hidden;">
        <div class="table-responsive">
            <table style="margin-bottom:0; width:100%; border-collapse:collapse;">
                <thead style="background:linear-gradient(135deg, var(--secondary-color) 0%, #e8d4bc 100%);">
                    <tr>
                        <th style="padding:1.2rem;">#</th>
                        <th style="padding:1.2rem;">Imagen</th>
                        <th style="padding:1.2rem;">Nombre</th>
                        <th style="padding:1.2rem;">Categoría (Id)</th>
                        <th style="padding:1.2rem;" class="text-end">Precio</th>
                        <th style="padding:1.2rem;" class="text-end">Imp. %</th>
                        <th style="padding:1.2rem;" class="text-end">Stock</th>
                        <th style="padding:1.2rem;">Activo</th>
                        <th style="padding:1.2rem; width:200px;">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        foreach (var p in Model)
                        {
                            <tr style="border-bottom:1px solid var(--secondary-color);">
                                <td style="padding:1.2rem;">@p.IdProducto</td>
                                <td style="padding:1.2rem;">
                                    @if (p.Imagen != null && p.Imagen.Length > 0)
                                    {
                                        var base64 = Convert.ToBase64String(p.Imagen);
                                        <img src="data:image/png;base64,@base64" alt="img"
                                             style="height:60px; width:auto; border-radius:10px;" />
                                    }
                                </td>
                                <td style="padding:1.2rem;">@p.NombreProducto</td>
                                <td style="padding:1.2rem;">@p.IdCategoria</td>
                                <td style="padding:1.2rem; text-align:end;">@p.Precio.ToString("C")</td>
                                <td style="padding:1.2rem; text-align:end;">@p.PorcentajeImpuesto</td>
                                <td style="padding:1.2rem; text-align:end;">@p.Cantidad</td>
                                <td style="padding:1.2rem;">@(p.Estado ? "Activo" : "Inactivo")</td>
                                <td style="padding:1.2rem;">
                                    <div class="btn-group" role="group">
                                        <a asp-action="EditarProducto" asp-route-id="@p.IdProducto" class="btn btn-sm btn-primary">Editar</a>
                                        <form asp-action="EliminarProducto" method="post" style="display:inline;"
                                              onsubmit="return confirm('¿Eliminar producto @p.NombreProducto?');">
                                            <input type="hidden" name="IdProducto" value="@p.IdProducto" />
                                            <button class="btn btn-sm btn-danger">Eliminar</button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr><td colspan="9" style="padding:1.2rem;">Sin productos.</td></tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
