@model List<Pasteleria.Abstracciones.ModeloUI.Producto>

@{
    ViewData["Title"] = "Productos";
    var categoria = ViewBag.Categoria as Pasteleria.Abstracciones.ModeloUI.Categoria;
}


<!-- Botón de regreso inferior (para móviles) -->
<div style="margin-bottom: 2rem;">
    <a href="@Url.Action("Index", "Catalogo")"
       class="btn btn-secondary"
       style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.6rem 1.5rem;">
        <i class="fas fa-arrow-left"></i> Volver
    </a>
</div>

<!-- Productos -->
<section class="products" style="padding: 4rem 0;">
    <div class="container">
        @if (Model != null && Model.Count > 0)
        {
            <div class="products-grid">
                @foreach (var producto in Model)
                {
                    <div class="product-card">
                        <div class="product-image">
                            @if (producto.Imagen != null && producto.Imagen.Length > 0)
                            {
                                var base64 = Convert.ToBase64String(producto.Imagen);
                                var imgSrc = $"data:image/jpeg;base64,{base64}";
                                <img src="@imgSrc" alt="@producto.NombreProducto" />
                            }
                            else
                            {
                                <img src="@Url.Content("~/images/producto-default.jpg")" alt="@producto.NombreProducto" />
                            }

                            @if (producto.Cantidad <= 5 && producto.Cantidad > 0)
                            {
                                <span class="badge badge-popular">¡Últimas @producto.Cantidad!</span>
                            }
                            else if (producto.Cantidad == 0)
                            {
                                <span class="badge" style="background: #666;">Agotado</span>
                            }
                        </div>
                        <div class="product-info">
                            <h3>@producto.NombreProducto</h3>
                            <p class="product-description">@producto.DescripcionProducto</p>
                            <div class="product-footer">
                                <span class="price">₡@producto.Precio.ToString("N0")</span>
                                @if (producto.Cantidad > 0)
                                {
                                    <a href="@Url.Action("DetalleProducto", "Catalogo", new { id = producto.IdProducto })" class="btn btn-primary">
                                        <i class="fas fa-shopping-cart"></i> Ver Detalles
                                    </a>
                                }
                                else
                                {
                                    <button class="btn btn-primary" style="opacity: 0.5;" disabled>
                                        <i class="fas fa-ban"></i> Agotado
                                    </button>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div style="text-align: center; padding: 3rem; background: var(--light-color); border-radius: 15px;">
                <i class="fas fa-box-open" style="font-size: 4rem; color: var(--secondary-color); margin-bottom: 1rem;"></i>
                <h3 style="color: var(--dark-color); margin-bottom: 0.5rem;">No hay productos disponibles</h3>
                <p style="color: var(--text-color);">Esta categoría aún no tiene productos</p>
                <a href="@Url.Action("Index", "Catalogo")" class="btn btn-primary" style="margin-top: 1rem;">
                    <i class="fas fa-arrow-left"></i> Volver al Catálogo
                </a>
            </div>
        }
    </div>
</section>

@section Scripts {
    <script src="~/js/catalogo.js"></script>
}